<html>
<body>
<h1>IDES Data Preparation</h1>
<ul>
<li>IDES Gateway: 
	<ul>
	<li><a href="https://wwwpse.idesgateway.com/"  target="_blank">test</a></li>
	<li><a href="https://www.idesgateway.com/"     target="_blank">live</a></li>
  <li><a href="https://www.irs.gov/Businesses/Corporations/IDES-Testing-Schedule" target="_blank">IDES Testing Schedule</a></li>
	</ul>
</li>
<li>
	Data transmittable to IDES for Fatca
	<ul>
	<li>Format&nbsp;
		<select id="format">
			<option value="html" selected>HTML</option>
			<option value="xml">XML</option>
			<option value="zip">Zip</option>
			<option value="metadata">Metadata</option>
		</select>
		<small><ul>
		<li>HTML: To see data in tabular format</li>
		<li>Xml: To see the data as it is stored in the file to be transmitted to IDES</li>
		<li>Zip: To get the file that should be transmitted to IDES</li>
		</ul></small>
	</li>
	<li><input type="checkbox" id="shuffled">&nbsp;Shuffled</li>
	<li>Document reference ID being corrected: <input type="text" id="corrDocRefId"></li>
	<li><select id="taxYear"><option value="2014" selected>2014</option><option value="2015">2015</option><option value="2016">2016</option></select></li>
	<li>Email to: <input type="text" id="emailTo"> (leave empty to not email)</li>
	<li><a href="api/transmitter.php?format=html&shuffle=false&taxYear=2014" target="_blank" id="datalink">Get data</a></li>
	</ul>
</li>
<li>
	File received from IDES:
	<form action="api/receiver.php" method="POST" target="_blank" enctype="multipart/form-data">
	<input type="file" name="myFile" id="myFile" accept="application/zip">
	<input type="submit" value="Read" disabled id="submitBtn" >
	</form>
</li>
</ul>
<script type="text/javascript">
document.getElementById('shuffled').onchange=
document.getElementById('format').onchange=
document.getElementById('corrDocRefId').onchange=
document.getElementById('emailTo').onchange=
document.getElementById('taxYear').onchange=function(e) {
	f=document.getElementById("format").value;
	s=document.getElementById("shuffled").checked;
	c=document.getElementById("corrDocRefId").value;
	e=document.getElementById("emailTo").value;
	y=document.getElementById("taxYear").value;
	h="api/transmitter.php?format="+f+"&shuffle="+(s?"true":"false")+"&taxYear="+y;
	if(c.length>0) {
		h+="&CorrDocRefId="+c;
	} 
	if(e.length>0) { h+="&emailTo="+e; } 
	document.getElementById("datalink").href=h;
}

document.getElementById('myFile').onchange = function(e) {
    var ext = this.value.match(/\.([^\.]+)$/)[1];
    switch(ext)
    {
        case 'zip':
            document.getElementById('submitBtn').disabled=false;
            break;
        default:
            alert('Files other than Zip not allowed');
            this.value='';
            document.getElementById('submitBtn').disabled=true;
    }
}
</script>
</body>
</html>
